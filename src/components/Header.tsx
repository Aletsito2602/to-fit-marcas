import React, { useState, useEffect } from 'react';
import { View, StyleSheet, TouchableOpacity, Image, Animated } from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import Svg, { Path } from 'react-native-svg';
import { useNavigation } from '@react-navigation/native';
import { DrawerNavigationProp } from '@react-navigation/drawer';
import { useAuth } from '../contexts/AuthContext';
import { useTiendaActual } from '../hooks/useTiendaActual';

interface HeaderProps {
  showNotifications?: boolean;
  showProfile?: boolean;
  showMenu?: boolean;
  scrollY?: Animated.Value;
}

const Header: React.FC<HeaderProps> = ({ 
  showNotifications = true, 
  showProfile = true,
  showMenu = true,
  scrollY
}) => {
  const navigation = useNavigation<DrawerNavigationProp<any>>();
  const { user } = useAuth();
  const { tienda } = useTiendaActual();

  const handleMenuPress = () => {
    navigation.openDrawer();
  };

  const handleProfilePress = () => {
    navigation.navigate('Profile' as never);
  };

  const headerOpacity = scrollY?.interpolate({
    inputRange: [0, 50],
    outputRange: [1, 0.85],
    extrapolate: 'clamp',
  }) || 1;

  const headerBlur = scrollY?.interpolate({
    inputRange: [0, 50],
    outputRange: [0, 10],
    extrapolate: 'clamp',
  }) || 0;

  return (
    <Animated.View style={[
      styles.header,
      {
        opacity: headerOpacity,
        backgroundColor: 'rgba(0, 0, 0, 0.8)',
      }
    ]}>
      <View style={styles.leftContainer}>
        {showMenu && (
          <TouchableOpacity style={styles.menuButton} onPress={handleMenuPress}>
            <Ionicons name="menu" size={24} color="#FFFFFF" />
          </TouchableOpacity>
        )}
      </View>
      
      <View style={styles.logoContainer}>
        <Svg width={80} height={45} viewBox="0 0 213 121" fill="none">
          <Path d="M13.68 83.375C11.1467 83.375 9.05667 83.0267 7.41 82.33C5.76333 81.6333 4.40167 80.715 3.325 79.575C1.995 77.865 1.33 75.8383 1.33 73.495C1.33 71.025 1.995 68.4917 3.325 65.895C4.71833 63.235 6.58667 60.8283 8.93 58.675C11.9067 55.8883 15.3267 53.64 19.19 51.93C23.0533 50.22 27.2333 49.365 31.73 49.365C33.1233 49.365 34.58 49.46 36.1 49.65C36.86 49.84 37.24 49.9983 37.24 50.125C37.24 50.315 36.955 50.41 36.385 50.41C35.9417 50.41 35.4667 50.3783 34.96 50.315C34.5167 50.2517 34.0417 50.22 33.535 50.22C30.9383 50.22 28.2783 50.7267 25.555 51.74C22.895 52.69 20.3617 53.9883 17.955 55.635C15.5483 57.2817 13.4267 59.055 11.59 60.955C10.1967 62.475 8.835 64.3117 7.505 66.465C6.23833 68.6183 5.38333 70.9617 4.94 73.495C4.87667 73.7483 4.845 74.0017 4.845 74.255C4.845 74.5083 4.845 74.7617 4.845 75.015C4.845 76.915 5.44667 78.53 6.65 79.86C7.85333 81.1267 9.81667 81.76 12.54 81.76C15.3267 81.76 17.9233 81.0633 20.33 79.67C22.8 78.2133 25.1117 76.44 27.265 74.35C29.4183 72.1967 31.4133 70.075 33.25 67.985C35.5933 65.325 38.19 61.905 41.04 57.725C43.89 53.545 46.8667 49.3967 49.97 45.28C52.06 42.4933 54.34 39.77 56.81 37.11C59.3433 34.3867 61.6233 32.3283 63.65 30.935C60.9267 30.6183 58.2033 30.27 55.48 29.89C52.7567 29.51 49.9383 29.2883 47.025 29.225C46.455 29.225 45.885 29.225 45.315 29.225C44.745 29.1617 44.2067 29.13 43.7 29.13C39.4567 29.13 35.435 29.605 31.635 30.555C27.8983 31.505 25.0167 33.3417 22.99 36.065C22.42 36.825 22.0083 37.585 21.755 38.345C21.5017 39.105 21.375 39.8333 21.375 40.53C21.375 41.4167 21.5967 42.24 22.04 43C22.2933 43.2533 22.5783 43.5383 22.895 43.855C23.2117 44.1083 23.4967 44.235 23.75 44.235C23.4967 44.4883 23.1483 44.615 22.705 44.615C22.2617 44.615 21.8183 44.52 21.375 44.33C20.995 44.0767 20.6783 43.8233 20.425 43.57C19.7917 42.8733 19.3167 42.0817 19 41.195C18.6833 40.245 18.525 39.3267 18.525 38.44C18.525 36.6667 18.9683 35.1783 19.855 33.975C23.275 29.2883 29.0383 26.945 37.145 26.945C37.6517 26.945 38.1583 26.945 38.665 26.945C39.235 26.945 39.7733 26.9767 40.28 27.04C44.9667 27.2933 49.59 27.7683 54.15 28.465C58.7733 29.1617 63.6183 29.51 68.685 29.51C71.4717 29.51 73.9733 29.3833 76.19 29.13C78.47 28.8133 79.99 28.275 80.75 27.515H80.94C81.1933 27.515 81.415 27.61 81.605 27.8C81.8583 27.9267 81.985 28.18 81.985 28.56C81.985 29.6367 81.3833 30.46 80.18 31.03C78.9767 31.5367 77.7417 31.8217 76.475 31.885C74.5117 31.885 72.58 31.8217 70.68 31.695C68.78 31.5683 66.9117 31.3783 65.075 31.125C63.4917 32.1383 61.5283 33.9117 59.185 36.445C56.905 38.9783 54.6883 42.1133 52.535 45.85C50.065 50.0933 47.5 54.4317 44.84 58.865C42.2433 63.2983 39.425 67.3517 36.385 71.025C33.4083 74.6983 30.0517 77.675 26.315 79.955C22.6417 82.235 18.43 83.375 13.68 83.375ZM52.6894 81.475C50.8527 81.475 49.5544 81.0317 48.7944 80.145C47.971 79.195 47.5594 78.0233 47.5594 76.63C47.5594 74.8567 48.066 72.7667 49.0794 70.36C50.156 67.9533 51.581 65.515 53.3544 63.045C55.1277 60.575 57.1227 58.295 59.3394 56.205C61.556 54.0517 63.8044 52.3417 66.0844 51.075C68.4277 49.745 70.676 49.08 72.8294 49.08C74.4127 49.08 75.5527 49.4917 76.2494 50.315C76.946 51.1383 77.2944 52.215 77.2944 53.545C77.2944 55.3183 76.7877 57.44 75.7744 59.91C74.761 62.3167 73.3677 64.7867 71.5944 67.32C69.8844 69.79 67.9527 72.1017 65.7994 74.255C63.7094 76.4083 61.5244 78.15 59.2444 79.48C56.9644 80.81 54.7794 81.475 52.6894 81.475ZM53.8294 79.67C55.1594 79.67 56.7427 79.005 58.5794 77.675C60.4794 76.2817 62.411 74.5083 64.3744 72.355C66.3377 70.2017 68.1427 67.9217 69.7894 65.515C71.4994 63.045 72.861 60.7333 73.8744 58.58C74.951 56.3633 75.4894 54.5583 75.4894 53.165C75.4894 51.645 74.761 50.885 73.3044 50.885C72.101 50.885 70.581 51.6133 68.7444 53.07C66.971 54.4633 65.1027 56.2683 63.1394 58.485C61.2394 60.7017 59.4344 63.045 57.7244 65.515C56.0144 67.985 54.621 70.3283 53.5444 72.545C52.531 74.7617 52.0244 76.5033 52.0244 77.77C52.0244 79.0367 52.626 79.67 53.8294 79.67Z" fill="white"/>
          <Path d="M116.652 79.6152H91.5156V77.3301H98.5469V29.166H91.5156V26.8809H132.033L132.473 42.7012H130.715L129.484 38.5703C129.426 38.3359 129.338 38.043 129.221 37.6914C127.404 32.0078 124.387 29.166 120.168 29.166H106.105V51.1387H124.211V53.6875H106.105V77.3301H116.652V79.6152ZM158.4 79.6152H136.867V77.3301H143.898V29.166H136.867V26.8809H158.4V29.166H151.457V77.3301H156.115C156.408 77.3301 156.701 77.3594 156.994 77.418C157.932 77.5938 158.4 78.3262 158.4 79.6152ZM199.006 79.6152H174.836V77.3301H183.186V29.166H178.439C173.928 29.5176 170.734 32.5645 168.859 38.3066L167.453 44.1953H164.992L165.432 26.8809H208.85L209.289 44.1953H206.828L205.422 38.3066C205.363 38.1895 205.334 38.0137 205.334 37.7793C203.752 32.0371 200.588 29.166 195.842 29.166H190.744V77.3301H196.721C197.014 77.3301 197.307 77.3594 197.6 77.418C198.537 77.5938 199.006 78.3262 199.006 79.6152Z" fill="white"/>
          <Path d="M79.0708 99.3516V99.9863H77.1177V113.365H78.436C78.5174 113.365 78.5988 113.373 78.6802 113.39C78.9406 113.438 79.0708 113.642 79.0708 114H73.2114V113.365H75.1646V101.549L69.5249 114.122H69.0122L63.6655 102.867V113.365H64.9839C65.0653 113.365 65.1466 113.373 65.228 113.39C65.4884 113.438 65.6187 113.642 65.6187 114H60.7358V113.365H62.689V99.9863H60.7358V99.3516H64.2271L69.8911 111.29L75.1646 99.3516H79.0708ZM94.769 114H89.4956V113.365H91.0825L89.2515 108.629H84.1489L82.3179 113.365H83.5142C83.5955 113.365 83.6769 113.373 83.7583 113.39C84.0187 113.438 84.1489 113.642 84.1489 114H79.8032V113.365H81.3413L86.8101 99.3516H87.7134L93.3042 113.365H94.1343C94.2157 113.365 94.297 113.373 94.3784 113.39C94.6388 113.438 94.769 113.642 94.769 114ZM88.9829 107.921L86.688 102.013L84.4175 107.921H88.9829ZM101.727 114H95.7456V113.365H97.6987V99.9863H95.7456V99.3516H102.972C104.242 99.3516 105.308 99.6445 106.17 100.23C107.228 100.963 107.757 101.939 107.757 103.16C107.757 103.665 107.652 104.161 107.44 104.649C106.87 105.886 105.812 106.692 104.266 107.066L108.197 113.365H109.125C109.238 113.365 109.336 113.373 109.417 113.39C109.613 113.438 109.71 113.642 109.71 114H106.024L102.118 107.286H99.7983V113.365H101.727V114ZM102.24 99.9863H99.7983V106.578H102.313C103.045 106.578 103.688 106.358 104.242 105.919C105.056 105.268 105.462 104.356 105.462 103.185C105.462 102.664 105.357 102.167 105.145 101.695C104.608 100.556 103.639 99.9863 102.24 99.9863ZM123.089 112.877C121.592 113.772 120.021 114.228 118.377 114.244C116.131 114.244 114.308 113.495 112.909 111.998C111.59 110.549 110.931 108.759 110.931 106.627C110.931 104.869 111.403 103.315 112.347 101.964C113.714 100.06 115.684 99.1074 118.255 99.1074C119.037 99.1074 119.802 99.1969 120.55 99.376C121.69 99.6689 122.495 100.051 122.967 100.523C122.967 100.084 122.992 99.7666 123.041 99.5713C123.122 99.3434 123.342 99.2295 123.7 99.2295L123.773 103.722H123.187C123.073 103.364 122.935 103.014 122.772 102.672C121.861 100.751 120.388 99.791 118.353 99.791C117.458 99.791 116.644 100.019 115.912 100.475C114.235 101.565 113.397 103.632 113.397 106.676C113.397 108.092 113.584 109.321 113.958 110.362C114.723 112.494 116.164 113.561 118.28 113.561C120.77 113.544 122.43 112.193 123.26 109.508H123.846V114.122C123.651 114.122 123.496 114.098 123.382 114.049C123.187 113.951 123.089 113.561 123.089 112.877ZM139.911 114H134.637V113.365H136.224L134.393 108.629H129.291L127.459 113.365H128.656C128.737 113.365 128.819 113.373 128.9 113.39C129.16 113.438 129.291 113.642 129.291 114H124.945V113.365H126.483L131.952 99.3516H132.855L138.446 113.365H139.276C139.357 113.365 139.439 113.373 139.52 113.39C139.78 113.438 139.911 113.642 139.911 114ZM134.125 107.921L131.83 102.013L129.559 107.921H134.125ZM151.776 110.167C151.776 111.16 151.426 112.014 150.726 112.73C149.701 113.74 148.252 114.244 146.38 114.244C144.785 114.244 143.361 113.829 142.108 112.999C142.108 113.341 142.092 113.577 142.059 113.707C141.994 113.935 141.766 114.049 141.375 114.049V108.995H142.108C142.385 112.006 143.768 113.528 146.258 113.561C146.893 113.561 147.471 113.447 147.992 113.219C149.098 112.714 149.652 111.892 149.652 110.753C149.652 110.313 149.546 109.907 149.334 109.532C148.944 108.865 148.016 108.206 146.551 107.555C144.972 106.871 144.045 106.456 143.768 106.31C142.238 105.447 141.473 104.332 141.473 102.965C141.473 102.053 141.799 101.256 142.45 100.572C143.426 99.5957 144.793 99.1074 146.551 99.1074C148 99.1074 149.302 99.4248 150.458 100.06C150.458 99.8643 150.474 99.7096 150.506 99.5957C150.571 99.3516 150.799 99.2295 151.19 99.2295V103.502H150.458C150.474 102.59 150.246 101.817 149.774 101.183C149.058 100.255 148.016 99.791 146.649 99.791C146.096 99.791 145.591 99.8805 145.135 100.06C144.077 100.483 143.548 101.24 143.548 102.33C143.548 102.737 143.646 103.119 143.841 103.478C144.216 104.129 145.127 104.763 146.576 105.382C148.171 106.082 149.123 106.513 149.432 106.676C150.995 107.555 151.776 108.718 151.776 110.167Z" fill="white" fillOpacity="0.7"/>
        </Svg>
      </View>
      
      <View style={styles.rightContainer}>
        {showNotifications && (
          <TouchableOpacity style={styles.iconButton}>
            <Ionicons name="notifications-outline" size={18} color="#FFFFFF" />
          </TouchableOpacity>
        )}
        
        {showProfile && (
          <TouchableOpacity style={styles.profileButton} onPress={handleProfilePress}>
            <Image 
              source={{ 
                uri: tienda?.logo || user?.photo_url || 'https://images.unsplash.com/photo-1494790108755-2616c0763a92?w=120&h=120&fit=crop&crop=face'
              }}
              style={styles.profileImage}
              defaultSource={{uri: 'https://images.unsplash.com/photo-1494790108755-2616c0763a92?w=120&h=120&fit=crop&crop=face'}}
            />
          </TouchableOpacity>
        )}
      </View>
    </Animated.View>
  );
};

const styles = StyleSheet.create({
  header: {
    position: 'absolute',
    top: 44,
    left: 0,
    right: 0,
    height: 60,
    backgroundColor: '#000000',
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'space-between',
    paddingHorizontal: 16,
    zIndex: 1000,
  },
  leftContainer: {
    flex: 1,
    alignItems: 'flex-start',
  },
  menuButton: {
    padding: 4,
  },
  logoContainer: {
    alignItems: 'center',
    justifyContent: 'center',
  },
  rightContainer: {
    flex: 1,
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'flex-end',
    gap: 12,
  },
  iconButton: {
    padding: 4,
  },
  profileButton: {
    padding: 2,
  },
  profileImage: {
    width: 24,
    height: 24,
    backgroundColor: '#FFFFFF',
    borderRadius: 5,
    borderWidth: 1,
    borderColor: '#9D9D9D',
  },
});

export default Header;